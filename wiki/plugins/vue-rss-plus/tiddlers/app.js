"use strict";const e=window.Vue;async function N(r){let n;r.startsWith("http")?n=await(await fetch(r)).text():n=r;const u=new DOMParser().parseFromString(n,"text/xml"),s=(l,m)=>{var v,h;return((h=(v=l==null?void 0:l.getElementsByTagName(m))==null?void 0:v[0])==null?void 0:h.textContent)||""},p=l=>{var m;try{return((m=new DOMParser().parseFromString(l,"text/html").querySelector("img"))==null?void 0:m.src)||""}catch{return""}},a=u.querySelector("channel")||u,g=u.querySelectorAll("item, entry"),x={title:s(a,"title"),link:s(a,"link"),description:s(a,"description"),update:B(s(a,"lastBuildDate")||s(a,"pubDate")||s(a,"updated"))||""},b=[...g].map(l=>{var d;const m=s(l,"title"),v=s(l,"link"),h=s(l,"description")||"",y=s(l,"content:encoded")||s(l,"content")||"",E=s(l,"pubDate")||s(l,"updated")||"",o=h+y,t=((d=l.querySelector("enclosure"))==null?void 0:d.getAttribute("url"))||"",c=p(y||h);return{title:m,link:v,summary:o,pubDate:E,mp3:t,src:c}});return{channel:x,items:b}}function B(r){var n=new Date(r),i=new Date,u=Math.abs(i-n)/1e3,s={年:31536e3,月:2592e3,周:604800,天:86400,小时:3600,分钟:60,秒:1},p="";for(var a in s){var g=Math.floor(u/s[a]);if(g>0){p+=g+" "+a+"前";break}}return p}const S={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},C=["id"],T=["fill"];function $(r,n){return e.openBlock(),e.createElementBlock("svg",S,[e.createElementVNode("defs",null,[e.createElementVNode("linearGradient",{id:r.idMap.vscodeIconsFileTypeRss0,x1:"30.06",x2:"225.94",y1:"30.06",y2:"225.94",gradientTransform:"matrix(.11 0 0 .11 2 2)",gradientUnits:"userSpaceOnUse"},n[0]||(n[0]=[e.createStaticVNode('<stop offset="0" stop-color="#e3702d"></stop><stop offset=".11" stop-color="#ea7d31"></stop><stop offset=".35" stop-color="#f69537"></stop><stop offset=".5" stop-color="#fb9e3a"></stop><stop offset=".7" stop-color="#ea7c31"></stop><stop offset=".89" stop-color="#de642b"></stop><stop offset="1" stop-color="#d95b29"></stop>',7)]),8,C)]),n[1]||(n[1]=e.createElementVNode("rect",{width:"28",height:"28",x:"2",y:"2",fill:"#cc5d15",rx:"6.01",ry:"6.01"},null,-1)),n[2]||(n[2]=e.createElementVNode("rect",{width:"26.91",height:"26.91",x:"2.54",y:"2.54",fill:"#f49c52",rx:"5.47",ry:"5.47"},null,-1)),e.createElementVNode("rect",{width:"25.82",height:"25.82",x:"3.1",y:"3.1",fill:"url(#"+r.idMap.vscodeIconsFileTypeRss0+")",rx:"5.14",ry:"5.14"},null,8,T),n[3]||(n[3]=e.createElementVNode("path",{fill:"#fff",d:"M6.82 6.16v3.83a15.31 15.31 0 0 1 15.3 15.3h3.83A19.14 19.14 0 0 0 6.81 6.17zm0 6.45v3.72a8.97 8.97 0 0 1 8.96 8.97h3.72A12.69 12.69 0 0 0 6.81 12.6zm2.62 7.44a2.63 2.63 0 0 0-2.63 2.62a2.63 2.63 0 0 0 2.63 2.63a2.63 2.63 0 0 0 2.63-2.63a2.63 2.63 0 0 0-2.63-2.63z"},null,-1))])}const D=e.markRaw({name:"tw-icons-rss",render:$,setup(){return{idMap:{vscodeIconsFileTypeRss0:"uicons-"+Math.random().toString(36).substr(2,10)}}}}),M={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"};function F(r,n){return e.openBlock(),e.createElementBlock("svg",M,n[0]||(n[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h6q.425 0 .713.288T12 4t-.288.713T11 5H5v14h6q.425 0 .713.288T12 20t-.288.713T11 21zm12.175-8H10q-.425 0-.712-.288T9 12t.288-.712T10 11h7.175L15.3 9.125q-.275-.275-.275-.675t.275-.7t.7-.313t.725.288L20.3 11.3q.3.3.3.7t-.3.7l-3.575 3.575q-.3.3-.712.288t-.713-.313q-.275-.3-.262-.712t.287-.688z"},null,-1)]))}const L=e.markRaw({name:"tw-icons-logout",render:F}),z={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"};function R(r,n){return e.openBlock(),e.createElementBlock("svg",z,n[0]||(n[0]=[e.createElementVNode("g",{fill:"currentColor"},[e.createElementVNode("path",{d:"M8 6.983a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2zM7 12a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 3.017a1 1 0 1 0 0 2h8a1 1 0 1 0 0-2z"}),e.createElementVNode("path",{"fill-rule":"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 1-16 0a8 8 0 0 1 16 0","clip-rule":"evenodd"})],-1)]))}const A=e.markRaw({name:"tw-icons-menu",render:R}),q={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"};function I(r,n){return e.openBlock(),e.createElementBlock("svg",q,n[0]||(n[0]=[e.createElementVNode("path",{fill:"currentColor",d:"M18 12.998h-5v5a1 1 0 0 1-2 0v-5H6a1 1 0 0 1 0-2h5v-5a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2"},null,-1)]))}const U=e.markRaw({name:"tw-icons-plus",render:I}),H=["src"],O={class:"flex-1 text-eft"},P=e.defineComponent({__name:"FeedButton",props:{feed:Object,selected:Boolean},emits:["load"],setup(r){return(n,i)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["w-full px-1 flex items-center py-2 text-sm text-gray-700 rounded border-none cursor-pointer hover:bg-gray-100 transition-colors group",r.selected?"bg-blue-100 font-bold":""]),onClick:i[0]||(i[0]=u=>n.$emit("load"))},[e.createElementVNode("img",{src:r.feed.favicon,class:"size-3 rounded-full mr-1"},null,8,H),e.createElementVNode("span",O,[e.createTextVNode(e.toDisplayString(r.feed.name)+" ",1),e.withDirectives(e.createElementVNode("span",{class:"text-xs text-gray-500 group-hover:text-gray-700 italic"}," ("+e.toDisplayString(r.feed.count)+") ",513),[[e.vShow,r.feed.count>0]])])],2))}}),j={class:"font-semibold mb-0"},G={class:"text-sm my-1 text-gray-600"},W={__name:"ArticleCard",props:{article:Object},setup(r){return(n,i)=>(e.openBlock(),e.createElementBlock("div",{class:"bg-white p-2 mb-2 rounded shadow cursor-pointer hover:bg-blue-50",onClick:i[0]||(i[0]=u=>n.$emit("click"))},[e.createElementVNode("h3",j,e.toDisplayString(r.article.title),1),e.createElementVNode("p",G,e.toDisplayString(r.article.summary),1)]))}},J=["https://www.freecodecamp.org/news/rss/","https://dev.to/feed","https://talk.tiddlywiki.org/posts.rss"],K="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='currentColor'%20d='m12%200l10.23%206v12L12%2024L1.77%2018V6zm3.961%2017.889l.154-.02c.113-.043.22-.081.288-.19c.227-.329-.357-.462-.566-.827c-.209-.364-1.071-2.364-.418-2.924s1.359-.79%201.629-1.315c.117-.236.238-.475.269-.742c.159.132.283.255.497.262c.567.036%201.054-.658%201.307-1.315c.135-.404.244-.832.218-1.226c-.069-.76.013-1.582.62-2.087c-.599.302-1.167.69-1.845.789c-.374-.114-.75-.216-1.147-.2c-.194-.253-.456-.727-.797-.782c-.58.208-.597%201.105-.842%202.321a5.351%205.351%200%200%200-1.154-.193c-.54-.035-1.42.134-2.038.116c-.619-.018-1.836-.562-2.849-.445c-.407.05-.817.12-1.195.291c-.231.105-.565.421-.733.468c-1.69.473-4.442.453-3.879-2.102c.044-.196.056-.373-.03-.417c-.11-.055-.17.06-.234.187c-.985%202.138.764%203.514%202.752%203.52c.625-.048.324-.007.904-.118l-.015.082a1.87%201.87%200%200%200%20.865%201.718c-.27.771-.805%201.389-1.173%202.097c.138.881%201.031%202.057%201.4%202.225c.326.147%201.036.149%201.2-.089c.059-.111.02-.351-.044-.474c.277.308.651.736%201.013.942c.217.104.434.17.677.18l.31-.016c.154-.033.336-.058.44-.195c.116-.2.007-.756-.476-.796c-.483-.04-.795-.222-1.24-.882c-.365-.638.077-1.517.226-2.145c.765.123%201.535.22%202.31.222c.336-.017.67-.03%201.001-.093c.106.27.402%201.025.404%201.239c.007.601-.219%201.205-.121%201.807c.06.177.005.512.35.526l.388.018l.267-.008c.341.573.637.572%201.307.591m-7.518-1.66l-.063-.056c-.184-.198-.66-.544-.572-.865c.075-.238.213-.457.323-.683l-.004.023c-.02.282-.059.56.032.837c.278.228.663.59.918.837c-.138-.038-.4-.117-.53-.066l-.104-.026z'/%3e%3c/svg%3e",Q={class:"flex h-screen"},X={class:"w-1/7 p-4",key:"sidebar"},Y={class:"flex items-center justify-between mb-6"},Z={class:"text-lg font-semibold text-gray-800 flex items-center gap-2"},ee={class:"mb-4 flex"},te={class:"flex mb-4 justify-between items-center"},oe={class:"space-y-1"},ne={class:"flex-1"},re={class:"bottom-1 absolute"},se={class:"overflow-y-auto p-4 w-2/7"},le={key:"skeleton"},ce={key:"article"},ae={class:"text-xl font-bold mb-4 -sticky py-1 top-0 z-10"},ie={class:"text-sm text-gray-500 mb-4"},de=["innerHTML"],ue={key:"empty"},me=e.defineComponent({__name:"RSS",setup(r){const n=()=>$tw.wiki.deleteTiddler("$:/layout");async function i(o){try{const{origin:t,hostname:c}=new URL(o),d=`${t}/favicon.ico`,w=await fetch(d);if(!w.ok)return"";const f=await w.blob();return await new Promise((V,k)=>{const _=new FileReader;_.onloadend=()=>V(_.result),_.onerror=k,_.readAsDataURL(f)})}catch{return K}}const u=e.ref(""),s=e.ref(""),p=e.ref(!0),a=e.ref([]),g=e.computed(()=>a.value.filter(o=>o.name.toLowerCase().includes(u.value.toLowerCase()))),x=e.ref(null),b=e.computed(()=>{const o=a.value.find(t=>t.name===x.value);return o?o.articles:[]}),l=e.ref(null),m=e.ref(!1);async function v(o){var c;if(!o.url)return;let t=o.url;if(window!=null&&window.electronAPI&&(t=await((c=window.electronAPI)==null?void 0:c.startFetchRSSData({url:o.url}))),!(o.articles&&o.articles.length>0))try{const{channel:d,items:w}=await N(t);o.articles=w.map((f,V)=>{var k;return{id:V,title:f.title,summary:((k=f.summary)==null?void 0:k.replace(/<[^>]+>/g,"").slice(0,100))||"",author:d.title||"",date:f.pubDate||"",content:f.summary||"",link:f.link,src:f.src,mp3:f.mp3}}),o.count=o.articles.length}catch{o.articles=[],o.count=0}}async function h(o){x.value=o;const t=a.value.find(c=>c.name===o);t&&((!t.articles||t.articles.length===0)&&await v(t),l.value=t.articles&&t.articles.length>0?t.articles[0]:null)}function y(o){m.value=!0,setTimeout(()=>{l.value=o,m.value=!1},100)}async function E(){const o=s.value.trim();if(!o)return;let t=new URL(o).hostname;if(a.value.some(w=>w.url===o||w.name===t)){s.value="";return}const c=await i(o),d={name:t,url:o,count:0,articles:[],favicon:c};a.value.push(d),x.value=t,s.value="",await v(d),l.value=d.articles&&d.articles.length>0?d.articles[0]:null}return e.onMounted(async()=>{for(const o of J.filter(t=>t.startsWith("http"))){let t=new URL(o).hostname;a.value.push({name:t,url:o,count:0,articles:[],favicon:""})}a.value.length>0&&h(a.value[0].name),a.value.forEach(async o=>{const t=await i(o.url);o.favicon=t})}),(o,t)=>(e.openBlock(),e.createElementBlock("div",Q,[e.createVNode(e.unref(A),{class:"cursor-pointer absolute top-6 right-6 z-20 rounded-full text-gray-800 backdrop-blur p-1 size-6 shadow",onClick:t[0]||(t[0]=c=>p.value=!p.value)}),e.createVNode(e.Transition,{name:"sidebar-slide"},{default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("div",X,[e.createElementVNode("div",Y,[e.createElementVNode("h2",Z,[t[3]||(t[3]=e.createTextVNode(" Feeds ")),e.createVNode(e.unref(D),{class:"size-4"})])]),e.createElementVNode("div",ee,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>u.value=c),type:"text",placeholder:"Search feeds...",class:"outline-gray-400 border w-full p-2"},null,512),[[e.vModelText,u.value]])]),e.createElementVNode("div",te,[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>s.value=c),type:"text",placeholder:"Add RSS URL",class:"p-2 border outline-gray-400 placeholder:text-gray-400"},null,512),[[e.vModelText,s.value]]),e.createVNode(e.unref(U),{class:"flex items-center bg-gray-300 ml-1 size-7 rounded-sm cursor-pointer",onClick:E})]),e.createElementVNode("div",oe,[t[4]||(t[4]=e.createElementVNode("div",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2"}," My Feeds ",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,c=>(e.openBlock(),e.createElementBlock("div",{key:c.name,class:"flex items-center group gap-1"},[e.createElementVNode("div",ne,[e.createVNode(P,{feed:c,selected:x.value===c.name,onLoad:d=>h(c.name)},null,8,["feed","selected","onLoad"])])]))),128)),e.createElementVNode("div",re,[e.createVNode(e.unref(L),{class:"cursor-pointer text-gray-500 size-4",onClick:n})])])],512),[[e.vShow,p.value]])]),_:1}),e.createElementVNode("div",se,[t[5]||(t[5]=e.createElementVNode("h2",{class:"text-lg mb-3 font-semibold"},"Articles",-1)),e.createVNode(e.TransitionGroup,{name:"fade",tag:"div"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(b.value,c=>(e.openBlock(),e.createBlock(W,{key:c.id,article:c,onClick:d=>y(c)},null,8,["article","onClick"]))),128))]),_:1})]),e.createElementVNode("div",{class:e.normalizeClass(["overflow-y-auto p-4 pt-0",[p.value?"w-4/7":"flex-1"]])},[e.createVNode(e.Transition,{name:"fade",mode:"out-in"},{default:e.withCtx(()=>[m.value?(e.openBlock(),e.createElementBlock("div",le)):l.value?(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("h3",ae,e.toDisplayString(l.value.title),1),e.createElementVNode("p",ie,e.toDisplayString(l.value.author)+", "+e.toDisplayString(l.value.date),1),e.createElementVNode("p",{innerHTML:l.value.content,class:"prose max-w-none"},null,8,de)])):(e.openBlock(),e.createElementBlock("div",ue,t[6]||(t[6]=[e.createElementVNode("div",{class:"text-gray-400 text-center mt-20"},"暂无文章",-1)])))]),_:1})],2)]))}}),pe=(r,n)=>{const i=r.__vccOpts||r;for(const[u,s]of n)i[u]=s;return i},fe=pe(me,[["__scopeId","data-v-bc48735a"]]),ve={class:"vue-rss-plus-plugin"},he=e.defineComponent({__name:"App",props:{title:{},theme:{},showLogos:{type:Boolean}},setup(r){return(n,i)=>(e.openBlock(),e.createElementBlock("div",ve,[e.createVNode(fe)]))}});function we(r={}){return function(n={}){const i={...r,...n};return{render(){return e.h(he,i)}}}}module.exports=we;
